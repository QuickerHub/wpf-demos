<UserControl
    x:Class="QuickerActionManage.View.SubprogramControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:editor="clr-namespace:QuickerActionManage.View.Editor"
    xmlns:fa="clr-namespace:FontAwesome5.WPF;assembly=FontAwesomeIconsWpf"
    xmlns:local="clr-namespace:QuickerActionManage.View"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:qk="https://getquicker.net"
    xmlns:viewmodel="clr-namespace:QuickerActionManage.ViewModel"
    d:DataContext="{d:DesignInstance Type=viewmodel:GlobalSubprogramListModel}"
    d:MaxHeight="500"
    d:Width="200"
    mc:Ignorable="d">
    <UserControl.Resources>
        <x:Array x:Key="testlist2" Type="viewmodel:SubprogramModel">
            <viewmodel:SubprogramModel Name="cccc" />
            <viewmodel:SubprogramModel Name="aaaa" />
            <viewmodel:SubprogramModel Name="bbbb" />
        </x:Array>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <DockPanel>
            <Button Click="CancelRef_Click" DockPanel.Dock="Right" Visibility="{Binding RefSubprogamId, Converter={StaticResource Object2VisibilityConverter}}">取消</Button>
            <local:PopupButtonControl DockPanel.Dock="Right" Header="排序">
                <editor:PropertyGridPlus SelectedObject="{Binding Sorter}" />
            </local:PopupButtonControl>
            <TextBox Text="{Binding FilterItem.SearchText, UpdateSourceTrigger=PropertyChanged}" />
        </DockPanel>
        <ListBox
            x:Name="TheSubprogramListBox"
            Grid.Row="1"
            HorizontalContentAlignment="Stretch"
            d:ItemsSource="{StaticResource testlist2}"
            BorderThickness="0"
            FocusVisualStyle="{x:Null}"
            ItemsSource="{Binding Subprograms}"
            MouseDoubleClick="TheSubprogramListBox_MouseDoubleClick"
            PreviewMouseRightButtonUp="TheSubprogramListBox_PreviewMouseRightButtonUp"
            SelectedItem="{Binding SelectedItem}"
            SelectionMode="Single">
            <ListBox.ContextMenu>
                <ContextMenu>
                    <ContextMenu.Resources>
                        <Style TargetType="qk:IconControl">
                            <Setter Property="DefaultIconColor" Value="{StaticResource DefaultMenuIconColorString}" />
                        </Style>
                    </ContextMenu.Resources>
                </ContextMenu>
            </ListBox.ContextMenu>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <DockPanel>
                        <Grid
                            d:Visibility="Visible"
                            DockPanel.Dock="Right"
                            Style="{StaticResource ListItemHoverContent}"
                            ToolTip="详细信息">
                            <local:PopupButtonControl Padding="5,0" VerticalAlignment="Center" ToggleButtonStyle="{StaticResource ToggleButtonCustom}">
                                <local:PopupButtonControl.Header>
                                    <fa:SvgAwesome
                                        Width="16"
                                        Height="16"
                                        Foreground="{StaticResource PrimaryBrush}"
                                        Icon="Light_InfoCircle" />
                                </local:PopupButtonControl.Header>
                                <editor:PropertyGridPlus SelectedObject="{Binding}" />
                            </local:PopupButtonControl>
                        </Grid>
                        <qk:IconControl
                            Width="16"
                            Height="16"
                            DockPanel.Dock="Left"
                            Icon="{StaticResource GlobalSubProgramIcon}" />
                        <TextBlock Margin="3,0" VerticalAlignment="Center" Text="{Binding Name}" />
                    </DockPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
        <Border Grid.Row="2" BorderBrush="Black" BorderThickness="0,0.5,0,0">
            <DockPanel Margin="5,3">
                <Button Name="Create" Click="Create_Click" DockPanel.Dock="Right">
                    <WrapPanel>
                        <fa:SvgAwesome Foreground="{StaticResource DefaultMenuIconColor}" Icon="Light_Plus" />
                        <TextBlock Margin="3,0,0,0">创建</TextBlock>
                    </WrapPanel>
                </Button>
                <TextBlock VerticalAlignment="Center" Text="{Binding ElementName=TheSubprogramListBox, Path=Items.Count, StringFormat='总计:{0}'}" />
            </DockPanel>
        </Border>
    </Grid>
</UserControl>

