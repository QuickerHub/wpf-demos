<Window
    x:Class="WindowAttach.Views.DetachPopupWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:WindowAttach.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    Title="DetachPopup"
    AllowsTransparency="True"
    Background="Transparent"
    ResizeMode="NoResize"
    ShowActivated="False"
    ShowInTaskbar="False"
    SizeToContent="WidthAndHeight"
    WindowStyle="None">
    <Border
        x:Name="MainBorder"
        Padding="4"
        Background="#80000000"
        BorderBrush="#40FFFFFF"
        BorderThickness="1"
        CornerRadius="4">
        <StackPanel
            x:Name="ExpandedPanel"
            MinWidth="0"
            Orientation="Horizontal">
            <StackPanel.Resources>
                <Style x:Key="ButtonBaseStyle" TargetType="Button">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Foreground" Value="White" />
                    <Setter Property="BorderThickness" Value="0" />
                    <Setter Property="Padding" Value="0" />
                    <Setter Property="Cursor" Value="Hand" />
                    <Setter Property="FontSize" Value="18" />
                    <Setter Property="FontWeight" Value="Bold" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border
                                    Padding="{TemplateBinding Padding}"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="2">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#40FFFFFF" />
                        </Trigger>
                    </Style.Triggers>
                </Style>

                <Style x:Key="ToggleButtonBaseStyle" TargetType="ToggleButton">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Foreground" Value="White" />
                    <Setter Property="BorderThickness" Value="0" />
                    <Setter Property="Padding" Value="0" />
                    <Setter Property="Cursor" Value="Hand" />
                    <Setter Property="FontSize" Value="16" />
                    <Setter Property="Focusable" Value="False" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ToggleButton">
                                <Border
                                    Padding="{TemplateBinding Padding}"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="2">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#40FFFFFF" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </StackPanel.Resources>

            <Button
                Width="24"
                Height="24"
                HorizontalContentAlignment="Center"
                VerticalContentAlignment="Center"
                Click="DetachButton_Click"
                Style="{StaticResource ButtonBaseStyle}"
                ToolTip="取消吸附">
                <Path
                    Width="16"
                    Height="16"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Data="M 6,6 L 18,18 M 18,6 L 6,18"
                    Stretch="Uniform"
                    Stroke="White"
                    StrokeEndLineCap="Round"
                    StrokeStartLineCap="Round"
                    StrokeThickness="2" />
            </Button>

            <Button
                x:Name="CallbackButton"
                Width="24"
                Height="24"
                Margin="4,0,0,0"
                Click="CallbackButton_Click"
                Content="▶"
                FontSize="12"
                FontWeight="Normal"
                Style="{StaticResource ButtonBaseStyle}"
                Visibility="Collapsed" />

            <controls:PopupButtonControl
                x:Name="PlacementButton"
                Width="24"
                Height="24"
                Margin="4,0,0,0"
                Padding="0"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                ToolTip="位置">
                <controls:PopupButtonControl.Header>
                    <Path
                        Width="16"
                        Height="16"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Data="M 12,2 L 12,6 M 12,18 L 12,22 M 2,12 L 6,12 M 18,12 L 22,12 M 12,2 L 10,4 L 12,6 L 14,4 Z M 12,22 L 10,20 L 12,18 L 14,20 Z M 2,12 L 4,10 L 6,12 L 4,14 Z M 22,12 L 20,10 L 18,12 L 20,14 Z"
                        Fill="White"
                        Stretch="Uniform"
                        Stroke="White"
                        StrokeThickness="1.5" />
                </controls:PopupButtonControl.Header>
                <controls:PopupButtonControl.ToggleButtonStyle>
                    <Style BasedOn="{StaticResource ToggleButtonBaseStyle}" TargetType="ToggleButton">
                        <Setter Property="Width" Value="24" />
                        <Setter Property="Height" Value="24" />
                        <Setter Property="HorizontalAlignment" Value="Stretch" />
                        <Setter Property="VerticalAlignment" Value="Stretch" />
                    </Style>
                </controls:PopupButtonControl.ToggleButtonStyle>
                <controls:PlacementSelectorControl PlacementSelected="PlacementSelector_PlacementSelected" />
            </controls:PopupButtonControl>

            <controls:PopupButtonControl
                x:Name="SettingsButton"
                Width="24"
                Height="24"
                Margin="4,0,0,0"
                Padding="0"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                ToolTip="设置">
                <controls:PopupButtonControl.Header>
                    <Ellipse
                        Width="16"
                        Height="16"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Stroke="White"
                        StrokeThickness="1.5" />
                </controls:PopupButtonControl.Header>
                <controls:PopupButtonControl.ToggleButtonStyle>
                    <Style BasedOn="{StaticResource ToggleButtonBaseStyle}" TargetType="ToggleButton">
                        <Setter Property="Width" Value="24" />
                        <Setter Property="Height" Value="24" />
                        <Setter Property="HorizontalAlignment" Value="Stretch" />
                        <Setter Property="VerticalAlignment" Value="Stretch" />
                    </Style>
                </controls:PopupButtonControl.ToggleButtonStyle>
                <controls:SettingsSelectorControl x:Name="SettingsSelector" SettingsChanged="SettingsSelector_SettingsChanged" />
            </controls:PopupButtonControl>
        </StackPanel>
    </Border>
</Window>
