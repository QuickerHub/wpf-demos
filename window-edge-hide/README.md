# Window Edge Hide

窗口贴边隐藏功能库，用于 Quicker 集成。

## 功能特性

### 核心功能

- **贴边隐藏**：当窗口移动到屏幕边缘时，鼠标离开窗口后自动隐藏到屏幕外（仅视觉隐藏，窗口仍在运行）
- **智能显示**：鼠标移回窗口区域时自动显示窗口
- **方向选择**：支持指定贴边方向（Left, Top, Right, Bottom, Nearest），Nearest 会自动选择最近的边缘

### 智能检测

- **边缘检测**：自动检测窗口位置，判断应该隐藏到哪个边缘
- **任务栏感知**：自动排除任务栏所在的边缘，避免在任务栏位置隐藏
- **多屏幕支持**：自动排除两块屏幕之间的边缘，避免在多屏边界处隐藏
- **窗口状态感知**：窗口最小化时自动禁用贴边隐藏功能，防止窗口状态异常

### 交互控制

- **鼠标检测**：通过定时器检测鼠标位置，触发窗口显示/隐藏
- **窗口激活检测**：窗口被激活时自动显示（如果处于隐藏状态）
- **窗口失活检测**：窗口失活且鼠标不在窗口内时自动隐藏（如果窗口在边缘）
- **屏幕边缘显示**（可选）：启用 `showOnScreenEdge` 后，鼠标移动到屏幕边缘时自动显示窗口

### 动画与性能

- **平滑动画**：支持平滑的窗口移动动画（200ms，60fps）
- **动画冲突处理**：隐藏和显示使用同一个动画器，确保动画不会冲突
- **直接移动**：默认使用直接移动，无动画延迟

### 可见区域配置

- **灵活配置**：支持灵活的可见区域配置（IntThickness）
  - `"5"` → 所有边 5 像素
  - `"5,6"` → 左右 5 像素，上下 6 像素
  - `"1,2,3,4"` → 左、上、右、下分别为 1、2、3、4 像素
- **负值支持**：负值会扩大鼠标检测区域，使窗口更容易显示

### 窗口管理

- **Topmost 管理**：启用时自动设置窗口为 Topmost，禁用时恢复原始状态
- **状态监控**：通过 `ManagedWindow` 实时监控窗口状态（IsVisible, IsActive, WindowState, Topmost）
- **Hook 机制**：使用 WinEvent Hook 实时检测窗口状态变化，无需轮询

## 使用方法

### 基本用法

```csharp
using WindowEdgeHide;

// 启用贴边隐藏（自动检测最近边缘，默认可见区域 5 像素）
Runner.EnableEdgeHide(windowHandle);

// 启用贴边隐藏（指定方向，使用动画，可见区域 -5 像素）
Runner.EnableEdgeHide(windowHandle, "Top", "-5", true);

// 启用贴边隐藏（指定方向，自定义可见区域，启用屏幕边缘显示）
Runner.EnableEdgeHide(windowHandle, "Left", "10,5", false, true);

// 禁用贴边隐藏
Runner.DisableEdgeHide(windowHandle);

// 检查是否已启用
bool isEnabled = Runner.IsEnabled(windowHandle);

// 禁用所有窗口的贴边隐藏
Runner.DisableAll();
```

### 参数说明

#### EnableEdgeHide 方法

- `windowHandle`: 窗口句柄（int 或 IntPtr）
- `edgeDirection`: 贴边方向字符串
  - `"Left"` - 左侧边缘
  - `"Top"` - 顶部边缘
  - `"Right"` - 右侧边缘
  - `"Bottom"` - 底部边缘
  - `"Nearest"` - 自动选择最近的边缘（默认）
- `visibleArea`: 可见区域厚度字符串（默认 `"5"`）
  - `"5"` - 所有边 5 像素
  - `"5,6"` - 左右 5 像素，上下 6 像素
  - `"1,2,3,4"` - 左、上、右、下分别为 1、2、3、4 像素
  - 负值会扩大鼠标检测区域
- `useAnimation`: 是否使用动画（默认 `false`）
  - `true` - 使用 200ms 平滑动画
  - `false` - 直接移动，无动画
- `showOnScreenEdge`: 是否在屏幕边缘显示窗口（默认 `false`）
  - `true` - 鼠标移动到屏幕边缘时自动显示窗口
  - `false` - 仅在鼠标进入窗口区域时显示

## 构建

```bash
dotnet build -c Release
```

## 依赖项

- .NET Framework 4.7.2
- WPF
- Windows Forms
- Microsoft.Windows.CsWin32
- log4net

## 工作原理

### 隐藏触发条件

窗口会在以下**所有**条件同时满足时自动隐藏：

1. 窗口位于屏幕边缘（考虑任务栏和多屏边界排除）
2. 鼠标不在窗口内
3. 窗口未激活（不是前台窗口）
4. 窗口未最小化

### 显示触发条件

窗口会在以下**任一**条件满足时自动显示：

1. 鼠标进入窗口区域
2. 窗口被激活（成为前台窗口）
3. 启用 `showOnScreenEdge` 且鼠标移动到屏幕边缘

### 状态管理

- **启用时**：窗口自动移动到指定边缘，设置为 Topmost，开始监控鼠标和窗口状态
- **禁用时**：恢复窗口原始位置和 Topmost 状态，清理所有监控资源
- **窗口最小化时**：自动暂停贴边隐藏功能，防止窗口状态异常

## 注意事项

- 窗口在任务栏所在的边缘不会触发贴边隐藏
- 窗口在两块屏幕之间的边缘不会触发贴边隐藏
- 动画时长固定为 200ms，帧率约 60fps
- 隐藏和显示使用同一个动画器，确保动画不会冲突
- 启用时会自动设置窗口为 Topmost，禁用时恢复原始状态
- 窗口最小化时功能自动暂停，恢复正常后继续工作

