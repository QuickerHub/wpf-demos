<Window
    x:Class="QuickerExpressionAgent.Quicker.QuickerServiceTestWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:local="clr-namespace:QuickerExpressionAgent.Quicker"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="IQuickerService API 测试"
    Width="1000"
    Height="800"
    d:DataContext="{d:DesignInstance Type=local:QuickerServiceTestWindow}"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>
    <ScrollViewer>
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  Status Card  -->
            <hc:Card Grid.Row="0" Margin="0,0,0,12">
                <StackPanel Margin="12" Orientation="Horizontal">
                    <Ellipse
                        Width="12"
                        Height="12"
                        Margin="0,0,12,0"
                        Fill="#4CAF50" />
                    <TextBlock
                        VerticalAlignment="Center"
                        FontSize="14"
                        Text="{Binding ViewModel.StatusText}" />
                </StackPanel>
            </hc:Card>

            <!--  Test Inputs Card  -->
            <hc:Card Grid.Row="1" Margin="0,0,0,12">
                <StackPanel Margin="12">
                    <TextBlock
                        Margin="0,0,0,12"
                        FontSize="16"
                        FontWeight="Bold"
                        Text="测试输入" />
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            Margin="0,0,12,12"
                            VerticalAlignment="Center"
                            Text="Handler ID:" />
                        <hc:TextBox
                            Grid.Row="0"
                            Grid.Column="1"
                            Margin="0,0,0,12"
                            hc:InfoElement.Placeholder="standalone"
                            Text="{Binding ViewModel.HandlerId, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="0"
                            Margin="0,0,12,12"
                            VerticalAlignment="Center"
                            Text="表达式:" />
                        <hc:TextBox
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="0,0,0,12"
                            hc:InfoElement.Placeholder="输入测试表达式"
                            Text="{Binding ViewModel.TestExpression, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="0"
                            Margin="0,0,12,12"
                            VerticalAlignment="Center"
                            Text="变量名:" />
                        <hc:TextBox
                            Grid.Row="2"
                            Grid.Column="1"
                            Margin="0,0,0,12"
                            hc:InfoElement.Placeholder="变量名称"
                            Text="{Binding ViewModel.TestVariableName, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock
                            Grid.Row="3"
                            Grid.Column="0"
                            Margin="0,0,12,12"
                            VerticalAlignment="Center"
                            Text="变量类型:" />
                        <ComboBox
                            Grid.Row="3"
                            Grid.Column="1"
                            Margin="0,0,0,12"
                            DisplayMemberPath="."
                            ItemsSource="{Binding ViewModel.VariableTypes}"
                            SelectedItem="{Binding ViewModel.SelectedVariableType}" />

                        <TextBlock
                            Grid.Row="4"
                            Grid.Column="0"
                            Margin="0,0,12,0"
                            VerticalAlignment="Center"
                            Text="变量值:" />
                        <hc:TextBox
                            Grid.Row="4"
                            Grid.Column="1"
                            hc:InfoElement.Placeholder="变量值（支持 JSON 格式）"
                            Text="{Binding ViewModel.TestVariableValue, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>
                </StackPanel>
            </hc:Card>

            <!--  Test Variables JSON Card  -->
            <hc:Card Grid.Row="2" Margin="0,0,0,12">
                <StackPanel Margin="12">
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            FontSize="16"
                            FontWeight="Bold"
                            Text="测试变量 JSON（用于 TestExpression）" />
                        <Button
                            Grid.Column="1"
                            Margin="8,0,8,0"
                            Command="{Binding ViewModel.LoadTestVariablesFromJsonCommand}"
                            Content="加载"
                            Style="{StaticResource ButtonInfo}" />
                        <Button
                            Grid.Column="2"
                            Command="{Binding ViewModel.ExportVariablesToJsonCommand}"
                            Content="导出"
                            Style="{StaticResource ButtonInfo}" />
                    </Grid>
                    <hc:TextBox
                        MinHeight="80"
                        MaxHeight="150"
                        hc:InfoElement.Placeholder="[{&quot;VarName&quot;:&quot;var1&quot;,&quot;VarType&quot;:&quot;String&quot;,&quot;DefaultValue&quot;:&quot;value1&quot;},...]"
                        AcceptsReturn="True"
                        FontFamily="Consolas"
                        FontSize="12"
                        Text="{Binding ViewModel.TestVariablesJson, UpdateSourceTrigger=PropertyChanged}"
                        TextWrapping="Wrap"
                        VerticalScrollBarVisibility="Auto" />
                </StackPanel>
            </hc:Card>

            <!--  Test Buttons Card  -->
            <hc:Card Grid.Row="3" Margin="0,0,0,12">
                <StackPanel Margin="12">
                    <TextBlock
                        Margin="0,0,0,12"
                        FontSize="16"
                        FontWeight="Bold"
                        Text="API 测试" />
                    <StackPanel>
                        <UniformGrid Margin="0,0,0,8" Columns="2">
                            <!--  Handler Operations  -->
                            <Button
                                MinHeight="36"
                                Margin="0,0,8,8"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding ViewModel.TestGetOrCreateCodeEditorCommand}"
                                IsEnabled="{Binding ViewModel.CanTest}"
                                Style="{StaticResource ButtonPrimary}">
                                <TextBlock
                                    Text="GetOrCreateCodeEditorAsync"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />
                            </Button>
                            <Button
                                MinHeight="36"
                                Margin="8,0,0,8"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding ViewModel.TestGetCodeWrapperIdCommand}"
                                IsEnabled="{Binding ViewModel.CanTest}"
                                Style="{StaticResource ButtonPrimary}">
                                <TextBlock
                                    Text="GetCodeWrapperIdAsync"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />
                            </Button>

                            <!--  Wrapper Operations (Require Code Editor Handler)  -->
                            <Button
                                MinHeight="36"
                                Margin="0,0,8,8"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding ViewModel.TestGetExpressionAndVariablesCommand}"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonSuccess}">
                                <TextBlock
                                    Text="GetExpressionAndVariablesForWrapperAsync"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />
                            </Button>
                            <Button
                                MinHeight="36"
                                Margin="8,0,0,8"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding ViewModel.TestSetExpressionForWrapperCommand}"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonSuccess}">
                                <TextBlock
                                    Text="SetExpressionForWrapperAsync"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />
                            </Button>

                            <!--  Variable Operations (Require Code Editor Handler)  -->
                            <Button
                                MinHeight="36"
                                Margin="0,0,8,8"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding ViewModel.TestGetVariableCommand}"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonInfo}">
                                <TextBlock
                                    Text="GetVariableForWrapperAsync"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />
                            </Button>
                            <Button
                                MinHeight="36"
                                Margin="8,0,0,8"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding ViewModel.TestSetVariableCommand}"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonInfo}">
                                <TextBlock
                                    Text="SetVariableForWrapperAsync"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />
                            </Button>
                            <Button
                                MinHeight="36"
                                Margin="0,0,8,8"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding ViewModel.TestGetAllVariablesCommand}"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonInfo}">
                                <TextBlock
                                    Text="GetAllVariables (详细)"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />
                            </Button>
                        </UniformGrid>

                        <!--  Test Expression (Require Code Editor Handler) - Full Width  -->
                        <Button
                            MinHeight="36"
                            Padding="8,6"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Command="{Binding ViewModel.TestTestExpressionForWrapperCommand}"
                            IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                            Style="{StaticResource ButtonWarning}">
                            <TextBlock
                                Text="TestExpressionForWrapperAsync"
                                TextAlignment="Center"
                                TextWrapping="Wrap" />
                        </Button>
                    </StackPanel>
                </StackPanel>
            </hc:Card>

            <!--  Test Result Card  -->
            <hc:Card Grid.Row="4">
                <StackPanel Margin="12">
                    <TextBlock
                        Margin="0,0,0,12"
                        FontSize="16"
                        FontWeight="Bold"
                        Text="测试结果" />
                    <hc:TextBox
                        MinHeight="100"
                        Padding="12"
                        Background="#F5F5F5"
                        BorderThickness="0"
                        FontFamily="Consolas"
                        FontSize="12"
                        IsReadOnly="True"
                        Text="{Binding ViewModel.TestResult, Mode=OneWay}"
                        TextWrapping="Wrap" />
                </StackPanel>
            </hc:Card>
        </Grid>
    </ScrollViewer>
</Window>

