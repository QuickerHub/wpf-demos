<Window x:Class="QuickerExpressionAgent.Quicker.QuickerServiceTestWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:local="clr-namespace:QuickerExpressionAgent.Quicker"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        Title="IQuickerService API 测试"
        Width="1000"
        Height="750"
        WindowStartupLocation="CenterScreen"
        d:DataContext="{d:DesignInstance Type=local:QuickerServiceTestWindow}"
        mc:Ignorable="d">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Status Card -->
        <hc:Card Grid.Row="0" Margin="0,0,0,12">
            <StackPanel Orientation="Horizontal" Margin="12">
                <Ellipse Width="12" Height="12" Fill="#4CAF50" Margin="0,0,12,0" />
                <TextBlock VerticalAlignment="Center" FontSize="14" Text="{Binding ViewModel.StatusText}" />
            </StackPanel>
        </hc:Card>

        <!-- Test Inputs Card -->
        <hc:Card Grid.Row="1" Margin="0,0,0,12">
            <StackPanel Margin="12">
                <TextBlock Text="测试输入" FontSize="16" FontWeight="Bold" Margin="0,0,0,12" />
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Margin="0,0,12,12" VerticalAlignment="Center" Text="Handler ID:" />
                    <hc:TextBox
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="0,0,0,12"
                        Text="{Binding ViewModel.HandlerId, UpdateSourceTrigger=PropertyChanged}"
                        hc:InfoElement.Placeholder="standalone" />

                    <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,0,12,12" VerticalAlignment="Center" Text="表达式:" />
                    <hc:TextBox
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="0,0,0,12"
                        Text="{Binding ViewModel.TestExpression, UpdateSourceTrigger=PropertyChanged}"
                        hc:InfoElement.Placeholder="输入测试表达式" />

                    <TextBlock Grid.Row="2" Grid.Column="0" Margin="0,0,12,12" VerticalAlignment="Center" Text="变量名:" />
                    <hc:TextBox
                        Grid.Row="2"
                        Grid.Column="1"
                        Margin="0,0,0,12"
                        Text="{Binding ViewModel.TestVariableName, UpdateSourceTrigger=PropertyChanged}"
                        hc:InfoElement.Placeholder="变量名称" />

                    <TextBlock Grid.Row="3" Grid.Column="0" Margin="0,0,12,0" VerticalAlignment="Center" Text="变量值:" />
                    <hc:TextBox
                        Grid.Row="3"
                        Grid.Column="1"
                        Text="{Binding ViewModel.TestVariableValue, UpdateSourceTrigger=PropertyChanged}"
                        hc:InfoElement.Placeholder="变量值" />
                </Grid>
            </StackPanel>
        </hc:Card>

        <!-- Test Buttons Card -->
        <hc:Card Grid.Row="2" Margin="0,0,0,12">
            <StackPanel Margin="12">
                <TextBlock Text="API 测试" FontSize="16" FontWeight="Bold" Margin="0,0,0,12" />
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <UniformGrid Columns="2" Margin="0,0,0,8">
                            <!-- Handler Operations -->
                            <Button
                                Margin="0,0,8,8"
                                HorizontalAlignment="Stretch"
                                Command="{Binding ViewModel.TestGetOrCreateCodeEditorCommand}"
                                Content="GetOrCreateCodeEditorAsync"
                                IsEnabled="{Binding ViewModel.CanTest}"
                                Style="{StaticResource ButtonPrimary}" />
                            <Button
                                Margin="8,0,0,8"
                                HorizontalAlignment="Stretch"
                                Command="{Binding ViewModel.TestGetCodeWrapperIdCommand}"
                                Content="GetCodeWrapperIdAsync"
                                IsEnabled="{Binding ViewModel.CanTest}"
                                Style="{StaticResource ButtonPrimary}" />

                            <!-- Wrapper Operations (Require Code Editor Handler) -->
                            <Button
                                Margin="0,0,8,8"
                                HorizontalAlignment="Stretch"
                                Command="{Binding ViewModel.TestGetExpressionAndVariablesCommand}"
                                Content="GetExpressionAndVariablesForWrapperAsync"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonSuccess}" />
                            <Button
                                Margin="8,0,0,8"
                                HorizontalAlignment="Stretch"
                                Command="{Binding ViewModel.TestSetExpressionForWrapperCommand}"
                                Content="SetExpressionForWrapperAsync"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonSuccess}" />

                            <!-- Variable Operations (Require Code Editor Handler) -->
                            <Button
                                Margin="0,0,8,8"
                                HorizontalAlignment="Stretch"
                                Command="{Binding ViewModel.TestGetVariableCommand}"
                                Content="GetVariableForWrapperAsync"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonInfo}" />
                            <Button
                                Margin="8,0,0,8"
                                HorizontalAlignment="Stretch"
                                Command="{Binding ViewModel.TestSetVariableCommand}"
                                Content="SetVariableForWrapperAsync"
                                IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                                Style="{StaticResource ButtonInfo}" />
                        </UniformGrid>

                        <!-- Test Expression (Require Code Editor Handler) - Full Width -->
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding ViewModel.TestTestExpressionForWrapperCommand}"
                            Content="TestExpressionForWrapperAsync"
                            IsEnabled="{Binding ViewModel.HasCodeEditorHandler}"
                            Style="{StaticResource ButtonWarning}" />
                    </StackPanel>
                </ScrollViewer>
            </StackPanel>
        </hc:Card>

        <!-- Test Result Card -->
        <hc:Card Grid.Row="3">
            <StackPanel Margin="12">
                <TextBlock Text="测试结果" FontSize="16" FontWeight="Bold" Margin="0,0,0,12" />
                <ScrollViewer
                    MaxHeight="250"
                    VerticalScrollBarVisibility="Auto">
                    <hc:TextBox
                        Background="#F5F5F5"
                        BorderThickness="0"
                        FontFamily="Consolas"
                        FontSize="12"
                        IsReadOnly="True"
                        Text="{Binding ViewModel.TestResult, Mode=OneWay}"
                        TextWrapping="Wrap"
                        Padding="12"
                        MinHeight="100" />
                </ScrollViewer>
            </StackPanel>
        </hc:Card>
    </Grid>
</Window>

