<Application
    x:Class="QuickerExpressionAgent.Desktop.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
    xmlns:behaviors="clr-namespace:QuickerExpressionAgent.Desktop.Behaviors"
    xmlns:local="clr-namespace:QuickerExpressionAgent.Desktop"
    xmlns:mdx="clr-namespace:MdXaml;assembly=MdXaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- Theme resources will be loaded dynamically by ApplicationThemeManager -->
                <ResourceDictionary Source="pack://application:,,,/Wpf.Ui;component/Resources/Wpf.Ui.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <!--  Color Resources - Using WPF UI built-in theme resources  -->
            <SolidColorBrush x:Key="PrimaryTextBrush" Color="#1F2937" />
            <SolidColorBrush x:Key="PrimaryBrush" Color="#0078D4" />
            <SolidColorBrush x:Key="AccentBrush" Color="#005A9E" />

            <!--  Note: Custom resource aliases are now directly mapped to WPF UI built-in resources  -->
            <!--  All XAML files should use {ui:ThemeResource ...} or {DynamicResource ...} with WPF UI resource keys  -->
            <!--  Mapping: CardBackgroundBrush -> ControlFillColorDefaultBrush, etc.  -->

            <!--  AvalonEdit TextEditor Default Style  -->
            <Style TargetType="{x:Type avalonEdit:TextEditor}">
                <Setter Property="Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                <Setter Property="BorderBrush" Value="{ui:ThemeResource ControlStrokeColorDefaultBrush}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                <Setter Property="FontFamily" Value="Consolas" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="Padding" Value="5,10" />
                <Setter Property="WordWrap" Value="True" />
                <Setter Property="HorizontalScrollBarVisibility" Value="Auto" />
                <Setter Property="VerticalScrollBarVisibility" Value="Auto" />
                <Setter Property="ShowLineNumbers" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type avalonEdit:TextEditor}">
                            <Border
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                                <ScrollViewer
                                    Name="PART_ScrollViewer"
                                    Padding="{TemplateBinding Padding}"
                                    HorizontalContentAlignment="Left"
                                    VerticalContentAlignment="Top"
                                    CanContentScroll="True"
                                    Content="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=TextArea}"
                                    Focusable="False"
                                    HorizontalScrollBarVisibility="{TemplateBinding HorizontalScrollBarVisibility}"
                                    VerticalScrollBarVisibility="{TemplateBinding VerticalScrollBarVisibility}" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!--  Page Default Style  -->
            <Style TargetType="{x:Type Page}">
                <Setter Property="Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
            </Style>

            <!--  MdXaml Markdown Style  -->
            <Style x:Key="MdStyle" TargetType="{x:Type FlowDocument}">
                <!--  Font and size related styles  -->
                <Setter Property="TextAlignment" Value="Left" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                <Setter Property="FontFamily" Value="Segoe UI, Microsoft YaHei, sans-serif" />
                <Setter Property="PagePadding" Value="10" />

                <Style.Resources>
                    <!--  Quote block style (left border line)  -->
                    <Style TargetType="{x:Type Section}">
                        <Setter Property="Margin" Value="0,10" />
                        <Setter Property="Padding" Value="10,0" />
                        <Setter Property="BorderBrush" Value="{ui:ThemeResource ControlStrokeColorSecondaryBrush}" />
                        <Setter Property="BorderThickness" Value="2.5,0,0,0" />
                    </Style>

                    <!--  Code block style  -->
                    <Style TargetType="{x:Type avalonEdit:TextEditor}">
                        <Setter Property="avalonEdit:TextEditor.HorizontalScrollBarVisibility" Value="Disabled" />
                        <Setter Property="avalonEdit:TextEditor.VerticalScrollBarVisibility" Value="Auto" />
                        <Setter Property="WordWrap" Value="True" />
                        <Setter Property="Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                        <Setter Property="Padding" Value="5,10" />
                        <Setter Property="Border.CornerRadius" Value="5" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type avalonEdit:TextEditor}">
                                    <Border
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        CornerRadius="{TemplateBinding Border.CornerRadius}">
                                        <ScrollViewer
                                            Name="PART_ScrollViewer"
                                            Padding="{TemplateBinding Padding}"
                                            HorizontalContentAlignment="Left"
                                            VerticalContentAlignment="Top"
                                            CanContentScroll="True"
                                            Content="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=TextArea}"
                                            Focusable="False"
                                            HorizontalScrollBarVisibility="Disabled"
                                            VerticalScrollBarVisibility="{TemplateBinding VerticalScrollBarVisibility}" />
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>

                    <!--  Headings and paragraphs  -->
                    <Style TargetType="{x:Type Paragraph}">
                        <Setter Property="Margin" Value="0,6" />
                        <Setter Property="Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                        <Style.Triggers>
                            <!--  Heading1  -->
                            <Trigger Property="FrameworkContentElement.Tag" Value="Heading1">
                                <Setter Property="Block.Margin" Value="0,10,0,0" />
                                <Setter Property="TextElement.Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                                <Setter Property="TextElement.FontSize" Value="18" />
                                <Setter Property="TextElement.FontWeight" Value="Light" />
                                <Setter Property="TextAlignment" Value="Center" />
                            </Trigger>
                            <!--  Heading2  -->
                            <Trigger Property="FrameworkContentElement.Tag" Value="Heading2">
                                <Setter Property="TextElement.Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                                <Setter Property="TextElement.FontSize" Value="15" />
                            </Trigger>
                            <!--  Heading3  -->
                            <Trigger Property="FrameworkContentElement.Tag" Value="Heading3">
                                <Setter Property="TextElement.Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                                <Setter Property="TextElement.FontSize" Value="13" />
                            </Trigger>
                            <!--  Heading4  -->
                            <Trigger Property="FrameworkContentElement.Tag" Value="Heading4">
                                <Setter Property="Block.Margin" Value="0,5,5,0" />
                                <Setter Property="TextElement.Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                                <Setter Property="TextElement.FontSize" Value="12" />
                            </Trigger>
                            <!--  CodeBlock  -->
                            <Trigger Property="FrameworkContentElement.Tag" Value="CodeBlock">
                                <Setter Property="TextElement.FontFamily" Value="Consolas, 'Courier New', monospace" />
                                <Setter Property="TextElement.FontSize" Value="13" />
                                <Setter Property="TextElement.Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                                <Setter Property="Block.Padding" Value="20,10" />
                            </Trigger>
                            <!--  Note  -->
                            <Trigger Property="FrameworkContentElement.Tag" Value="Note">
                                <Setter Property="Margin" Value="5,0,5,0" />
                                <Setter Property="Padding" Value="10,5" />
                                <Setter Property="BorderBrush" Value="{ui:ThemeResource ControlStrokeColorSecondaryBrush}" />
                                <Setter Property="BorderThickness" Value="3,3,3,3" />
                                <Setter Property="TextElement.Background" Value="{ui:ThemeResource ControlFillColorTertiaryBrush}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>

                    <!--  Inline code style  -->
                    <Style TargetType="{x:Type Run}">
                        <Style.Triggers>
                            <Trigger Property="FrameworkContentElement.Tag" Value="CodeSpan">
                                <Setter Property="TextElement.FontFamily" Value="Consolas, 'Courier New', monospace" />
                                <Setter Property="TextElement.FontSize" Value="13" />
                                <Setter Property="TextElement.Background" Value="{ui:ThemeResource ControlFillColorTertiaryBrush}" />
                                <Setter Property="TextElement.Foreground" Value="{ui:ThemeResource AccentTextFillColorPrimaryBrush}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>

                    <!--  Hyperlink style  -->
                    <Style TargetType="{x:Type Hyperlink}">
                        <Setter Property="Inline.TextDecorations" Value="None" />
                        <Setter Property="Foreground" Value="{ui:ThemeResource AccentTextFillColorPrimaryBrush}" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{ui:ThemeResource AccentTextFillColorSecondaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsMouseCaptured" Value="True">
                                <Setter Property="Foreground" Value="{ui:ThemeResource TextFillColorDisabledBrush}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>

                    <!--  Image style  -->
                    <Style TargetType="{x:Type Image}">
                        <Style.Triggers>
                            <Trigger Property="FrameworkElement.Tag" Value="imageright">
                                <Setter Property="HorizontalAlignment" Value="Right" />
                            </Trigger>
                            <Trigger Property="Tag" Value="imageleft">
                                <Setter Property="HorizontalAlignment" Value="Left" />
                            </Trigger>
                            <Trigger Property="Tag" Value="imagecenter">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>

                    <!--  List style  -->
                    <Style TargetType="{x:Type List}">
                        <Setter Property="Margin" Value="0,5" />
                    </Style>

                    <!--  Table style  -->
                    <Style TargetType="{x:Type Table}">
                        <Setter Property="Table.CellSpacing" Value="0" />
                        <Setter Property="Block.BorderThickness" Value="0.3" />
                        <Setter Property="Background" Value="{ui:ThemeResource ControlFillColorDefaultBrush}" />
                        <Setter Property="BorderBrush" Value="{ui:ThemeResource ControlStrokeColorDefaultBrush}" />
                        <Style.Resources>
                            <Style TargetType="{x:Type TableCell}">
                                <Setter Property="TableCell.BorderThickness" Value="0.2" />
                                <Setter Property="TableCell.BorderBrush" Value="{ui:ThemeResource ControlStrokeColorDefaultBrush}" />
                                <Setter Property="TableCell.Padding" Value="13,6" />
                            </Style>
                        </Style.Resources>
                    </Style>

                    <!--  Table header style  -->
                    <Style TargetType="{x:Type TableRowGroup}">
                        <Style.Triggers>
                            <Trigger Property="FrameworkContentElement.Tag" Value="TableHeader">
                                <Setter Property="TextElement.FontWeight" Value="Bold" />
                                <Setter Property="TextElement.Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>

                    <!--  Even table row style  -->
                    <Style TargetType="{x:Type TableRow}">
                        <Style.Triggers>
                            <Trigger Property="FrameworkContentElement.Tag" Value="EvenTableRow">
                                <Setter Property="TextElement.Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>

                    <!--  Horizontal rule style  -->
                    <Style TargetType="{x:Type BlockUIContainer}">
                        <Style.Triggers>
                            <Trigger Property="FrameworkContentElement.Tag" Value="RuleSingle">
                                <Setter Property="Block.Margin" Value="0,3" />
                            </Trigger>
                            <Trigger Property="FrameworkContentElement.Tag" Value="RuleDouble">
                                <Setter Property="Block.Margin" Value="0,3" />
                            </Trigger>
                            <Trigger Property="FrameworkContentElement.Tag" Value="RuleBold">
                                <Setter Property="Block.Margin" Value="0,3" />
                            </Trigger>
                            <Trigger Property="FrameworkContentElement.Tag" Value="RuleBoldWithSingle">
                                <Setter Property="Block.Margin" Value="0,3" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>

                    <!--  Separator style  -->
                    <Style TargetType="{x:Type Separator}">
                        <Setter Property="Height" Value="0.5" />
                        <Setter Property="Background" Value="{ui:ThemeResource ControlStrokeColorDefaultBrush}" />
                    </Style>
                </Style.Resources>
            </Style>

            <!--  Apply MdStyle to MarkdownScrollViewer (for assistant messages)  -->
            <Style TargetType="{x:Type mdx:MarkdownScrollViewer}">
                <Setter Property="MarkdownStyle" Value="{StaticResource MdStyle}" />
                <Setter Property="Background" Value="Transparent" />
            </Style>
        </ResourceDictionary>
    </Application.Resources>
</Application>
