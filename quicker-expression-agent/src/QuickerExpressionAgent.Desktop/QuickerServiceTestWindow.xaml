<Window x:Class="QuickerExpressionAgent.Desktop.QuickerServiceTestWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:local="clr-namespace:QuickerExpressionAgent.Desktop"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:QuickerExpressionAgent.Desktop.ViewModels"
        Title="IQuickerService API 测试"
        Width="900"
        Height="700"
        WindowStartupLocation="CenterScreen"
        d:DataContext="{d:DesignInstance Type=local:QuickerServiceTestWindow}"
        mc:Ignorable="d">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <local:InvertBooleanConverter x:Key="InvertBooleanConverter" />
    </Window.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Connection Status -->
        <GroupBox Grid.Row="0" Header="连接状态" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" VerticalAlignment="Center" Text="{Binding ViewModel.StatusText}" />
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button
                        Margin="0,0,10,0"
                        Padding="10,5"
                        Command="{Binding ViewModel.ConnectCommand}"
                        Content="连接"
                        IsEnabled="{Binding ViewModel.IsConnecting, Converter={StaticResource InvertBooleanConverter}}" />
                    <Button
                        Padding="10,5"
                        Command="{Binding ViewModel.DisconnectCommand}"
                        Content="断开"
                        IsEnabled="{Binding ViewModel.IsConnected}" />
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Test Inputs -->
        <GroupBox Grid.Row="1" Header="测试参数" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Margin="0,0,10,5" VerticalAlignment="Center" Text="Handler ID:" />
                <TextBox Grid.Row="0" Grid.Column="1" Margin="0,0,0,5" Text="{Binding ViewModel.HandlerId, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,0,10,5" VerticalAlignment="Center" Text="测试表达式:" />
                <TextBox Grid.Row="1" Grid.Column="1" Margin="0,0,0,5" Text="{Binding ViewModel.TestExpression, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Grid.Row="2" Grid.Column="0" Margin="0,0,10,5" VerticalAlignment="Center" Text="变量名:" />
                <TextBox Grid.Row="2" Grid.Column="1" Margin="0,0,0,5" Text="{Binding ViewModel.TestVariableName, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Grid.Row="3" Grid.Column="0" Margin="0,0,10,0" VerticalAlignment="Center" Text="变量值:" />
                <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding ViewModel.TestVariableValue, UpdateSourceTrigger=PropertyChanged}" />
            </Grid>
        </GroupBox>

        <!-- Test Buttons -->
        <GroupBox Grid.Row="2" Header="API 测试">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <UniformGrid Columns="2" Margin="10">
                    <!-- Handler Operations -->
                    <Button
                        Margin="5"
                        Padding="10,8"
                        Command="{Binding ViewModel.TestGetOrCreateCodeEditorCommand}"
                        Content="GetOrCreateCodeEditorAsync"
                        IsEnabled="{Binding ViewModel.CanTest}" />
                    <Button
                        Margin="5"
                        Padding="10,8"
                        Command="{Binding ViewModel.TestGetCodeWrapperIdCommand}"
                        Content="GetCodeWrapperIdAsync"
                        IsEnabled="{Binding ViewModel.CanTest}" />

                    <!-- Wrapper Operations (Require Code Editor Handler) -->
                    <Button
                        Margin="5"
                        Padding="10,8"
                        Command="{Binding ViewModel.TestGetExpressionAndVariablesCommand}"
                        Content="GetExpressionAndVariablesForWrapperAsync"
                        IsEnabled="{Binding ViewModel.HasCodeEditorHandler}" />
                    <Button
                        Margin="5"
                        Padding="10,8"
                        Command="{Binding ViewModel.TestSetExpressionForWrapperCommand}"
                        Content="SetExpressionForWrapperAsync"
                        IsEnabled="{Binding ViewModel.HasCodeEditorHandler}" />

                    <!-- Variable Operations (Require Code Editor Handler) -->
                    <Button
                        Margin="5"
                        Padding="10,8"
                        Command="{Binding ViewModel.TestGetVariableCommand}"
                        Content="GetVariableForWrapperAsync"
                        IsEnabled="{Binding ViewModel.HasCodeEditorHandler}" />
                    <Button
                        Margin="5"
                        Padding="10,8"
                        Command="{Binding ViewModel.TestSetVariableCommand}"
                        Content="SetVariableForWrapperAsync"
                        IsEnabled="{Binding ViewModel.HasCodeEditorHandler}" />

                    <!-- Test Expression (Require Code Editor Handler) -->
                    <Button
                        Margin="5"
                        Padding="10,8"
                        Command="{Binding ViewModel.TestTestExpressionForWrapperCommand}"
                        Content="TestExpressionForWrapperAsync"
                        IsEnabled="{Binding ViewModel.HasCodeEditorHandler}" />
                </UniformGrid>
            </ScrollViewer>
        </GroupBox>

        <!-- Test Result -->
        <GroupBox Grid.Row="3" Header="测试结果" Margin="0,10,0,0">
            <ScrollViewer
                MaxHeight="200"
                VerticalScrollBarVisibility="Auto">
                <TextBox
                    Margin="10"
                    Background="White"
                    BorderThickness="0"
                    FontFamily="Consolas"
                    FontSize="12"
                    IsReadOnly="True"
                    Text="{Binding ViewModel.TestResult, Mode=OneWay}"
                    TextWrapping="Wrap" />
            </ScrollViewer>
        </GroupBox>
    </Grid>
</Window>

